<!--
  PwC Express – Édition Promus (mobile-first, no button)
  - Hooded "Assassin’s Creed"-style SVG avatar centered
  - Marrakech color palette + matrix-rain background
  - Male deep voice (fr-CA preferred), slow rate; no on-screen script
  - No button; if autoplay is blocked on mobile, a full-screen tap overlay appears (not a button) to start audio.
  - Single-file, responsive. Drop-in and open on phone.
-->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>PwC Express – Édition Promus</title>
  <style>
    :root{
      /* Marrakech palette */
      --marrakech-deep:#2b0d0d; /* dark auburn */
      --marrakech-warm:#7a2f2f; /* date red */
      --marrakech-terracotta:#c05b4d; /* terracotta */
      --marrakech-sand:#e7c27d; /* desert sand */
      --marrakech-teal:#0e8b80; /* oasis teal */
      --text-bright:#ffe8c9;
      --avatar-stroke:#1a1a1a;
      --avatar-fill:#0c0c0e;
      --glow:#e7c27d;
    }

    html,body{
      margin:0; padding:0; height:100%; width:100%;
      background: radial-gradient(1200px 800px at 50% 10%, var(--marrakech-warm), var(--marrakech-deep) 60%) fixed;
      color:var(--text-bright);
      overflow:hidden;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }

    /* Matrix canvas behind everything */
    #matrix{
      position:fixed; inset:0; z-index:0; display:block;
      filter: saturate(1.1) contrast(1.05) brightness(0.9);
      opacity:0.55;
    }

    /* Top title */
    header{
      position:fixed; top:env(safe-area-inset-top); left:0; right:0; z-index:2;
      text-align:center; padding: clamp(8px, 2.5vh, 18px) 12px 6px;
      pointer-events:none;
    }
    header h1{
      margin:0; font-weight:900; letter-spacing:0.5px;
      font-size: clamp(20px, 4.8vw, 38px);
      line-height:1.1; text-transform:none;
      text-shadow: 0 1px 0 rgba(0,0,0,.6), 0 8px 30px rgba(231,194,125,.35);
    }

    /* Avatar container */
    .stage{
      position:fixed; inset:0; z-index:1; display:grid; place-items:center;
      padding: max(10px, env(safe-area-inset-bottom));
    }
    .avatar-wrap{
      width:min(78vw, 460px); aspect-ratio:1/1; max-height:70vh;
      display:grid; place-items:center; border-radius:28px;
      box-shadow: 0 10px 40px rgba(0,0,0,.5), inset 0 0 120px rgba(14,139,128,.08);
      position:relative; overflow:visible;
      backdrop-filter: blur(2px) saturate(1.05);
    }
    /* ring glow */
    .avatar-wrap::before{
      content:""; position:absolute; inset:-18px; border-radius:30px;
      background: conic-gradient(from 220deg, rgba(231,194,125,.0), rgba(231,194,125,.28) 40%, rgba(14,139,128,.25) 60%, rgba(231,194,125,.0) 85%);
      filter: blur(16px); z-index:-1; opacity:.9;
      pointer-events:none;
    }

    /* Speaking pulse */
    .speaking .avatar-wrap::after{
      content:""; position:absolute; inset:-3px; border-radius:28px;
      box-shadow: 0 0 0 0 rgba(231,194,125,.55);
      animation: pulse 1.6s ease-out infinite;
    }
    @keyframes pulse{
      0% { box-shadow: 0 0 0 0 rgba(231,194,125,.55); }
      70% { box-shadow: 0 0 0 24px rgba(231,194,125,0); }
      100% { box-shadow: 0 0 0 0 rgba(231,194,125,0); }
    }

    /* Hooded avatar (SVG sized to container) */
    .avatar{
      width: 100%; height: 100%; display:block;
      filter: drop-shadow(0 14px 40px rgba(0,0,0,.6));
    }
    /* Subtle breathing */
    .breath{ animation: breath 3.8s ease-in-out infinite; transform-origin:50% 80%; }
    @keyframes breath{ 0%,100%{ transform: scale(1.00);} 50%{ transform: scale(1.02);} }

    /* Tap overlay (only if audio blocked) */
    #tapstart{
      position:fixed; inset:0; z-index:3; display:none; place-items:center; cursor: pointer;
      background: radial-gradient(800px 600px at 50% 50%, rgba(231,194,125,.12), rgba(0,0,0,.55));
      color:var(--text-bright); text-align:center; padding:24px;
      -webkit-user-select:none; user-select:none;
    }
    #tapstart.active{ display:grid; }
    #tapstart .card{
      padding:14px 18px; border-radius:14px; backdrop-filter: blur(5px) brightness(1.05);
      background: linear-gradient(180deg, rgba(14,139,128,.18), rgba(0,0,0,.35));
      box-shadow: 0 10px 30px rgba(0,0,0,.4), inset 0 0 40px rgba(231,194,125,.08);
      font-weight:600; font-size: clamp(14px, 3.8vw, 18px);
    }

    /* Safe areas spacing on very small heights */
    @media (max-height: 640px){
      header h1{ font-size: clamp(18px, 4.6vw, 28px); }
      .avatar-wrap{ max-height:64vh; }
    }
  </style>
</head>
<body>
  <canvas id="matrix" aria-hidden="true"></canvas>

  <header>
    <h1>PwC Express – Édition Promus</h1>
  </header>

  <main class="stage" id="stage">
    <div class="avatar-wrap" aria-label="Narrateur masqué">
      <!-- Assassin’s Creed‑style hooded avatar (no text) -->
      <svg class="avatar breath" viewBox="0 0 600 600" role="img" aria-hidden="true">
        <defs>
          <radialGradient id="hoodGlow" cx="50%" cy="20%" r="70%">
            <stop offset="0%" stop-color="#222"/>
            <stop offset="60%" stop-color="#0c0c0e"/>
            <stop offset="100%" stop-color="#050507"/>
          </radialGradient>
          <linearGradient id="edge" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#4b3a2a"/>
            <stop offset="50%" stop-color="#8b2f2f"/>
            <stop offset="100%" stop-color="#0e8b80"/>
          </linearGradient>
          <filter id="grain">
            <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" result="noise"/>
            <feColorMatrix in="noise" type="saturate" values="0"/>
            <feBlend in="SourceGraphic" in2="noise" mode="overlay" opacity=".06"/>
          </filter>
        </defs>
        <!-- Cloak shoulders -->
        <path d="M100 520 C 210 430, 390 430, 500 520 L 520 600 L 80 600 Z" fill="url(#hoodGlow)" stroke="var(--avatar-stroke)" stroke-opacity=".6"/>
        <!-- Hood -->
        <path d="M300 60 C 200 120, 140 250, 170 360 C 230 330, 370 330, 430 360 C 460 250, 400 120, 300 60 Z" fill="url(#hoodGlow)" stroke="url(#edge)" stroke-width="3"/>
        <!-- Inner shadow face -->
        <path d="M220 250 C 240 220, 360 220, 380 250 C 385 310, 365 360, 300 380 C 235 360, 215 310, 220 250 Z" fill="#020203"/>
        <!-- Nose ridge highlight -->
        <path d="M300 250 C 296 300, 296 340, 300 360" stroke="#3c2a1f" stroke-width="2" stroke-linecap="round" opacity=".5"/>
        <!-- Hood rim details -->
        <path d="M170 360 C 230 330, 370 330, 430 360" fill="none" stroke="url(#edge)" stroke-width="2" opacity=".75"/>
        <!-- Ambient grains -->
        <g filter="url(#grain)"></g>
      </svg>
    </div>
  </main>

  <!-- Tap-to-start overlay (only if needed by mobile autoplay policies) -->
  <div id="tapstart" aria-live="polite" aria-label="Touchez pour activer la voix">
    <div class="card">Touchez l’écran pour activer la narration</div>
  </div>

  <script>
    /* -------------------- Matrix rain background (Marrakech palette) -------------------- */
    (function(){
      const c = document.getElementById('matrix');
      const ctx = c.getContext('2d');
      let W, H, cols, drops, fontSize;
      const glyphs = ('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ' + '✧✦✺✹✷✶•').split('');

      function resize(){
        W = c.width = window.innerWidth * devicePixelRatio;
        H = c.height = window.innerHeight * devicePixelRatio;
        ctx.setTransform(1,0,0,1,0,0);
        fontSize = Math.max(14, Math.min(24, Math.floor(W/40)));
        ctx.font = fontSize + 'px monospace';
        cols = Math.floor(W / (fontSize * 0.6));
        drops = Array(cols).fill(0).map(()=> Math.random()*H);
      }
      resize();
      window.addEventListener('resize', resize, {passive:true});

      function draw(){
        // Warm translucent veil
        ctx.fillStyle = 'rgba(43,13,13,0.12)';
        ctx.fillRect(0,0,W,H);
        for(let i=0;i<cols;i++){
          const x = i * (fontSize*0.6);
          const y = drops[i];
          // Color blend: sand & teal
          ctx.fillStyle = (Math.random()<0.85) ? 'rgba(231,194,125,0.85)' : 'rgba(14,139,128,0.85)';
          const ch = glyphs[(Math.random()*glyphs.length)|0];
          ctx.fillText(ch, x, y);
          const speed = fontSize * (1.2 + Math.random()*0.6);
          drops[i] = (y > H + 50) ? -Math.random()*200 : y + speed;
        }
        requestAnimationFrame(draw);
      }
      requestAnimationFrame(draw);
    })();

    /* -------------------- Speech synthesis (fr-CA male deep, slow) -------------------- */
    const scriptText = `Félicitations. Si vous êtes ici, c’est que vous êtes promus et que vous faites partie des sélectionnés chanceux et chanceuses pour vivre un PwC Express pas comme les autres, au cœur de Marrakech. Aujourd’hui, vous allez compter sur votre regard, votre écoute, votre instinct, et votre cohésion… d’une façon à laquelle vous ne vous attendez pas. Le rendez-vous est au niveau de la Koutoubia. Tout sera expliqué sur place : le déroulé, les rôles, le périmètre, les consignes. Pas besoin d’en savoir plus pour l’instant — gardez l’esprit ouvert, certaines surprises ne se dévoilent qu’au dernier moment. Pendant l’expérience, restez fidèles à nos valeurs : Intégrité, Make a Difference, Care, Work Together, Reimagine the Possible. Votre manière d’être comptera autant que ce que vous ferez. Quelques repères simples pour bien vivre l’aventure : restez ensemble. Marchez, ne courez pas. Respectez les habitants, les commerçants et les lieux. Écoutez les Game Masters et suivez leurs indications. Si quelque chose vous semble risqué, on s’abstient et on prévient. Fair-play intégral, aucune triche. On préserve le patrimoine : on ne déplace rien, on ne force rien. Et surtout : gardez le sourire. À l’arrivée, vous récupérerez votre kit, vous écouterez le brief, puis vous attendrez le signal de départ. Prêts à voir la médina autrement ? Bienvenue dans PwC Express – Édition Promus.`;

    let isSpeaking = false; let overlayShown = false; let utterances = [];
    const stage = document.getElementById('stage');
    const tapstart = document.getElementById('tapstart');
    const body = document.body;

    function chooseVoice(){
      const voices = window.speechSynthesis.getVoices();
      if(!voices || !voices.length) return null;
      // Prefer French (Canada) — try to bias toward deeper male voices by common names
      const score = v => {
        let s = 0;
        if(/fr-?CA/i.test(v.lang)) s += 6; else if(/fr/i.test(v.lang)) s += 3;
        if(/Google|Microsoft|Siri/i.test(v.name)) s += 1;
        if(/Paul|Claude|Mathieu|Michel|Felix|Louis|Yves|Thomas|Antoine/i.test(v.name)) s += 2; // male-ish
        return s;
      };
      return voices.slice().sort((a,b)=> score(b)-score(a))[0] || null;
    }

    function splitIntoSegments(text){
      // Split on sentence boundaries to allow natural pacing
      return text
        .replace(/\s+/g,' ')
        .split(/(?<=[.!?…])\s+/)
        .filter(Boolean);
    }

    function buildUtterances(text){
      const voice = chooseVoice();
      const segments = splitIntoSegments(text);
      utterances = segments.map(seg=>{
        const u = new SpeechSynthesisUtterance(seg);
        if(voice) u.voice = voice;
        u.lang = (voice && voice.lang) || 'fr-CA';
        u.rate = 0.88; // slow-ish
        u.pitch = 0.8; // deeper
        u.volume = 1.0;
        return u;
      });
      // Insert short pauses by empty utterances (mobile Safari ignores SSML, so we chain tiny pauses)
      const withPauses = [];
      utterances.forEach((u,i)=>{
        withPauses.push(u);
        if(i < utterances.length-1){
          const pause = new SpeechSynthesisUtterance(' ');
          pause.rate = 0.1; pause.volume = 0; pause.pitch = 0.8; pause.lang = u.lang;
          withPauses.push(pause);
        }
      });
      utterances = withPauses;
      return utterances;
    }

    function speak(){
      if(isSpeaking) return;
      window.speechSynthesis.cancel();
      buildUtterances(scriptText);
      body.classList.add('speaking');
      isSpeaking = true;
      let finished = 0;
      utterances.forEach(u=>{
        u.onend = () => {
          finished++;
          if(finished === utterances.length){
            isSpeaking = false; body.classList.remove('speaking');
          }
        };
        u.onerror = () => { isSpeaking = false; body.classList.remove('speaking'); };
        window.speechSynthesis.speak(u);
      });
    }

    function tryAutoplay(){
      try {
        if(!('speechSynthesis' in window)) return showOverlay();
        // Some browsers need voices to be loaded first
        const startNow = () => {
          // If document not interacted, many mobile browsers still allow TTS; if not, we fallback to overlay
          try {
            speak();
            // If it didn’t actually start, schedule an overlay check
            setTimeout(()=>{
              if(!isSpeaking) showOverlay();
            }, 600);
          } catch(e){ showOverlay(); }
        };
        const v = window.speechSynthesis.getVoices();
        if(v && v.length){ startNow(); }
        else {
          window.speechSynthesis.onvoiceschanged = () => startNow();
          // Fallback timer if voiceschanged never fires
          setTimeout(startNow, 800);
        }
      } catch(e){ showOverlay(); }
    }

    function showOverlay(){
      if(overlayShown) return; overlayShown = true;
      tapstart.classList.add('active');
    }
    function hideOverlay(){ tapstart.classList.remove('active'); }

    // Any interaction triggers TTS if blocked
    function armInteraction(){
      const start = ()=>{ hideOverlay(); speak(); window.removeEventListener('pointerdown', start); window.removeEventListener('keydown', start); };
      window.addEventListener('pointerdown', start, {once:true});
      window.addEventListener('keydown', start, {once:true});
      tapstart.addEventListener('click', start, {once:true});
    }

    document.addEventListener('visibilitychange', ()=>{
      // Pause/resume when tab switches to keep flow consistent
      if(document.hidden){ window.speechSynthesis.cancel(); isSpeaking = false; body.classList.remove('speaking'); }
      else if(!isSpeaking && !tapstart.classList.contains('active')){ tryAutoplay(); }
    });

    // Boot
    tryAutoplay();
    armInteraction();
  </script>
</body>
</html>
